{% comment %}
  Product Custom Section
{% endcomment %}

<section id="product-custom-section" class="product-custom">
  {% assign product = all_products[section.settings.product] %}

  {% if product %}
    <div class="product">
      <!-- Product Image -->
      <div class="product-image">
        <img src="{{ product.featured_image | img_url: 'large' }}" alt="{{ product.title }}" />
      </div>

      <!-- Product Title -->
      <h2 class="product-title">{{ product.title }}</h2>

      <!-- Product Price -->
      <p class="product-price">{{ product.price | money }}</p>

      <!-- Product Description -->
      <div class="product-description">
        <p>{{ product.description | strip_html | truncate: 150 }}</p> <!-- Adjust length as needed -->
      </div>

      <!-- Quantity Selector -->
      <div class="quantity-selector">
        <button class="quantity-button" id="quantity-decrease">-</button>
        <input type="number" id="quantity" name="quantity" value="1" min="1" max="{{ product.variants.first.inventory_quantity }}" />
        <button class="quantity-button" id="quantity-increase">+</button>
      </div>

      <!-- Purchase Button -->
      <button id="purchase-button" class="purchase-button">
        Buy Now
      </button>
    </div>
  {% else %}
    <p>No product found. Please assign a valid product to this section.</p>
  {% endif %}
</section>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const quantityInput = document.getElementById("quantity");
    const decreaseButton = document.getElementById("quantity-decrease");
    const increaseButton = document.getElementById("quantity-increase");
    const purchaseButton = document.getElementById("purchase-button");

    // Update quantity based on button click
    function changeQuantity(amount) {
      const currentQuantity = parseInt(quantityInput.value);
      const maxQuantity = {{ product.variants.first.inventory_quantity }};
      let newQuantity = currentQuantity + amount;

      // Clamp the quantity to be between 1 and the available inventory
      if (newQuantity < 1) newQuantity = 1;
      if (newQuantity > maxQuantity) newQuantity = maxQuantity;

      quantityInput.value = newQuantity;
    }

    // Attach event listeners to increase and decrease buttons
    decreaseButton.addEventListener("click", function() {
      changeQuantity(-1);  // Decrease by 1
    });

    increaseButton.addEventListener("click", function() {
      changeQuantity(1);  // Increase by 1
    });

    // Handle purchase button click
    purchaseButton.addEventListener("click", function() {
      const quantity = parseInt(quantityInput.value);
      const variantId = "{{ product.variants.first.id }}";
      
      // Redirect to checkout with specified quantity
      window.location.href = `/cart/${variantId}:${quantity}`;
    });
  });
</script>

{% schema %}
  {
    "name": "Product Custom Section",
    "settings": [
      {
        "type": "product",
        "id": "product",
        "label": "Select Product"
      }
    ],
    "presets": [
      {
        "name": "Product Custom"
      }
    ]
  }
{% endschema %}
